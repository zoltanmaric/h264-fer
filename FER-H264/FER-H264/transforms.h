#include <stdio.h>

#define Sign(sign,value) ((sign)?(-(value)):(value))

typedef struct {
  int Lwidth, Lheight, Lpitch;
  int Cwidth, Cheight, Cpitch;
  unsigned char *L, *C[2];
} frame;

typedef struct {
	int elements[4][4];
} block;

//used for Chroma DC elements transformation
typedef struct {
	int elements[2][2];
} small_block;

//Multiplication factors for quantization
int factorsQ[6][4][4] = 
{
	{{13107,8066,13107,8066},{8066,5243,8066,5243},{13107,8066,13107,8066},{8066,5243,8066,5243}},
	{{11916,7490,11916,7490},{7490,4660,7490,4660},{11916,7490,11916,7490},{7490,4660,7490,4660}},
	{{10082,6554,10082,6554},{6554,4194,6554,4194},{10082,6554,10082,6554},{6554,4194,6554,4194}},
	{{9362,5825, 9352,5825},{5825,3647,5825,3647},{9362,5825, 9352,5825},{5825,3647,5825,3647}},
	{{8192,5243, 8192,5243},{5243,3355,5243,3355},{8192,5243, 8192,5243},{5243,3355,5243,3355}},
	{{7282,4559, 7282,4559},{4559,2893,4559,2893},{7282,4559, 7282,4559},{4559,2893,4559,2893}}
};

//Multiplication factors for inverse quantization
int factorsDQ[6][4][4] = 
{
	{{10,13,10,13},{13,16,13,16},{10,13,10,13},{13,16,13,16}},
	{{11,14,11,14},{14,18,14,18},{11,14,11,14},{14,18,14,18}},
	{{13,16,13,16},{16,20,16,20},{13,16,13,16},{16,20,16,20}},
	{{14,18,14,18},{18,23,18,23},{14,18,14,18},{18,23,18,23}},
	{{16,20,16,20},{20,25,20,25},{16,20,16,20},{20,25,20,25}},
	{{18,23,18,23},{23,29,23,29},{18,23,18,23},{23,29,23,29}}
};

int ZigZagReordering[16][2] = 
{
	{0,0}, {0,1}, {1,0}, {2,0}, {1,1}, {0,2}, {0,3}, {1,2},
	{2,1}, {3,0}, {3,1}, {2,2}, {1,3}, {2,3}, {3,2}, {3,3}
};

block ReorderElements (int *input);
void InverseResidualLuma (int *input, frame current, int x, int y, int quantizer, int dc);

void forwardTransform4x4(int input[4][4], int output[4][4]);